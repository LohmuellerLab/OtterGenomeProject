#!/bin/bash
#$ -cwd
#$ -l h_rt=5:00:00,h_data=28G,highp
#$ -N elut2simulate1
#$ -m abe
#$ -M ab08028
rundate=`date +%Y%m%d`
model=elut2.msmc.full.8.644114e-09
mkdir -p ${model}
for j in {1..6}
do
mkdir -p ${model}/group_$j.${model}
cd ${model}/group_$j.${model}
cp ../../../macs ./
cp ../../../msformatter ./
for i in {1..10}
do
# northern sea otter otter msmc model -- full msmc
mu=8.644114e-09
r=1e-08
Na=423871.87794
rho=0.0169548751176
theta=0.0146559873372
date=`date +%Y%m%d`
SEED=$((date+$RANDOM+((j-1)*10)+i))
# this is a new addition! need to have a different random seed for each simulation; if they start within a second of each other, they will have the same seed. not an issue for big simulations of 30Mb because those are slow, but 100kb can start within a second of each other!
./macs 2 30000000 -t 0.0146559873372 -r 0.0169548751176 -s $SEED -eN 0.0 0.00906164920249 -eN 0.00022239648036 0.00665202661532 -eN 0.000450570121825 0.00572606464445 -eN 0.0006848259192 0.00620836650668 -eN 0.0009255057123 0.00791525767814 -eN 0.0011729677165 0.0102748998584 -eN 0.0014275940282 0.0126229568853 -eN 0.00168982815215 0.0143919467617 -eN 0.00196013406255 0.0153293732013 -eN 0.00223902349565 0.0154938132836 -eN 0.00252705594975 0.0147399927198 -eN 0.0028248523315 0.0147399927198 -eN 0.00313310177905 0.0131578795125 -eN 0.00345256166205 0.0131578795125 -eN 0.0037840780511 0.0116753792319 -eN 0.00412859936405 0.0116753792319 -eN 0.0044871900123 0.010616053647 -eN 0.0048610440471 0.010616053647 -eN 0.00525151245215 0.0100185742603 -eN 0.0056601577288 0.0100185742603 -eN 0.0060887334266 0.00988325185588 -eN 0.00653930696 0.00988325185588 -eN 0.0070142664315 0.0102715742727 -eN 0.0075163138085 0.0102715742727 -eN 0.008048860666 0.0113749499867 -eN 0.0086157961995 0.0113749499867 -eN 0.0092218283825 0.0136721814395 -eN 0.009872825124 0.0136721814395 -eN 0.0105759507315 0.0183841290498 -eN 0.0113402799945 0.0183841290498 -eN 0.0121774804995 0.0288864992559 -eN 0.0131029725655 0.0288864992559 -eN 0.0141376350315 0.0557012298411 -eN 0.015310602748 0.0557012298411 -eN 0.0166646568655 0.137194521187 -eN 0.0182661866335 0.137194521187 -eN 0.0202263411655 0.444441187582 -eN 0.022753431231 0.444441187582 -eN 0.0263150472995 1.0 -eN 0.032403821665 1.0  > group_${j}_block_${i}.${model}.macsFormat.OutputFile.${rundate}.txt 
./msformatter < group_${j}_block_${i}.${model}.macsFormat.OutputFile.${rundate}.txt > group_${j}_block_${i}.${model}.msFormat.OutputFile.${rundate}.txt
done
cd ../../
done
